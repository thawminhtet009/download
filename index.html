<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hentai Gallery - Post Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(135deg, #232526 0%, #4a90e2 100%);
      color: #222;
      margin: 0;
      padding: 1.5rem;
      min-height: 100vh;
    }
    h2 {
      text-align: center;
      font-size: 2em;
      color: #4a90e2;
      margin-bottom: 24px;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 0 2px 12px #4a90e244;
    }
    .search-bar {
      width: 100%;
      max-width: 420px;
      padding: 12px 10px;
      border-radius: 14px;
      border: none;
      font-size: 1.08em;
      background: #fff;
      color: #4a90e2;
      box-shadow: 0 2px 12px #4a90e244;
      outline: none;
      margin-bottom: 24px;
      transition: box-shadow 0.2s;
    }
    .search-bar:focus {
      box-shadow: 0 4px 18px #4a90e288;
      background: #eaf6ff;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 10px;
    }
    .card {
      background: linear-gradient(135deg, #fff 60%, #eaf6ff 100%);
      padding: 1.2rem 1rem 1rem 1rem;
      border-radius: 18px;
      box-shadow: 0 8px 32px #4a90e222, 0 2px 8px #0002;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: scale(1.03) translateY(-2px);
      box-shadow: 0 12px 36px #4a90e244;
    }
    .card img {
      width: 100%;
      border-radius: 14px;
      box-shadow: 0 2px 12px #4a90e244;
      margin-bottom: 10px;
      height: 180px;
      object-fit: cover;
    }
    .card h3 {
      color: #4a90e2;
      font-size: 1.18em;
      margin: 0 0 6px 0;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .card p {
      color: #222;
      font-size: 0.98em;
      margin: 0 0 8px 0;
    }
    .downloads a {
      display: inline-block;
      margin: 3px 6px 3px 0;
      color: #fff;
      background: linear-gradient(90deg, #4a90e2 60%, #4a90e2 100%);
      padding: 7px 14px;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      font-size: 0.98em;
      box-shadow: 0 2px 8px #4a90e244;
      transition: background 0.2s, transform 0.2s;
    }
    .downloads a:hover {
      background: linear-gradient(90deg, #eaf6ff 0%, #4a90e2 100%);
      transform: scale(1.08);
      color: #222;
    }
    .downloads hr {
      border: 0;
      border-top: 1px solid #eaf6ff;
      margin: 8px 0;
    }
  </style>
</head>
<body>
  <h2>üîó Hentai Post Viewer</h2>
  <div style="max-width:420px;margin:0 auto 18px auto;">
    <input type="text" id="searchInput" class="search-bar" placeholder="üîç Search by title or category...">
  </div>
  <div class="gallery" id="gallery"></div>

  <script>
    const sheetAPI = "https://sheets.googleapis.com/v4/spreadsheets/1yFi2LC02KhBQZ4m6kfzad_1FBsom9QDABPUHS7RKOJM/values/download!A2:E100?key=AIzaSyDZqMYFCHG17qgCbrFhyoEIdrR9ua86348";

    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    function parseEpisodes(raw) {
      if (!raw) return '';
      const episodes = raw.split('|').map(ep => {
        const [epTitle, ...links] = ep.split(':');
        const linkParts = links.join(':').split(',').map(l => {
          const [name, url] = l.split('=');
          return `<a href="${url?.trim()}" target="_blank">${name?.trim()}</a>`;
        }).join('');
        return `<strong>${epTitle.trim()}</strong><br>${linkParts}`;
      });
      return `<div class="downloads">${episodes.join('<hr>')}</div>`;
    }

    async function loadPosts() {
      const postId = getParam("post");
      const gallery = document.getElementById("gallery");

      try {
        const res = await fetch(sheetAPI);
        const json = await res.json();
        const rows = json.values.reverse();

        const filteredRows = postId ? rows.filter(row => row[0] === postId) : rows;

        if (filteredRows.length === 0) {
          gallery.innerHTML = `<p style='text-align:center;'>‚ùå No matching post(s) found.</p>`;
          return;
        }

        gallery.innerHTML = filteredRows.map(row => {
          const [id, title, category, image, episodes] = row;
          return `
            <div class="card">
              <img src="${image}" alt="${title}" loading="lazy">
              <h3>${title}</h3>
              <p><strong>Category:</strong> ${category}</p>
              ${parseEpisodes(episodes)}
            </div>
          `;
        }).join('');

      } catch (err) {
        gallery.innerHTML = "<p style='text-align:center;'>‚ùå Failed to load post(s).</p>";
        console.error(err);
      }
    }

    function filterPosts() {
      const value = document.getElementById("searchInput").value.toLowerCase();
      const postId = getParam("post");
      const gallery = document.getElementById("gallery");
      fetch(sheetAPI)
        .then(res => res.json())
        .then(json => {
          const rows = json.values.reverse();
          let filteredRows = postId ? rows.filter(row => row[0] === postId) : rows;
          if (value) {
            filteredRows = filteredRows.filter(row =>
              (row[1] && row[1].toLowerCase().includes(value)) ||
              (row[2] && row[2].toLowerCase().includes(value))
            );
          }
          if (filteredRows.length === 0) {
            gallery.innerHTML = `<p style='text-align:center;'>‚ùå No matching post(s) found.</p>`;
            return;
          }
          gallery.innerHTML = filteredRows.map(row => {
            const [id, title, category, image, episodes] = row;
            return `
              <div class="card">
                <img src="${image}" alt="${title}" loading="lazy">
                <h3>${title}</h3>
                <p><strong>Category:</strong> ${category}</p>
                ${parseEpisodes(episodes)}
              </div>
            `;
          }).join('');
        });
    }

    document.addEventListener("DOMContentLoaded", loadPosts);
    document.getElementById("searchInput").addEventListener("input", filterPosts);
  </script>
</body>
</html>
